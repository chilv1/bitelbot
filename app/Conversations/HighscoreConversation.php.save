<?php

namespace App\Conversations;

use App\Highscore;
use BotMan\BotMan\Messages\Conversations\Conversation;

class HighscoreConversation extends Conversation
{
    /**
     * Start the conversation.
     *
     * @return mixed
     */
    public function run()
    {
        $this->showHighscore();
    }

    private function showHighscore()
    {
        $topUsers = Highscore::topUsers();

        if (! $topUsers->count()) {
            return $this->say('La puntuacion mas alta sigue vacia. Se el primero! ðŸ‘');
        }

        $topUsers->transform(function ($user) {
            return "{$user->rank} - {$user->name} : *{$user->points} puntos* - {$user->telephone}";
        });

        $this->say('Aqui esta la puntuacion mas alta ðŸ¥‡ðŸ¥ˆðŸ¥‰ .40 personas en la lista recibiran 5 soles ðŸ’µðŸ’µðŸ’µ. Crees que puedes hacerlo mejor? ðŸ‘©â€ðŸ’»ðŸ‘¨â€ðŸ’» Iniciar otra vez: /start.');
        $this->say('ðŸ† *LOS MEJORES* ðŸ†', ['parse_mode' => 'Markdown']);
        $this->say($topUsers->implode("\n"), ['parse_mode' => 'Markdown']);
    }
}
